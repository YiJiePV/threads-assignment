# threads-assignment (May-June 2023)
An Operating Systems Assignment

Karena Qian  
Threads Assignment  
CSC 3350  
May 30, 2023

## Sample Execution Outputs

1.
```
Average of thread A is: 50.51

Thread A Time: 3468.38903 ms

Average of thread C is: 50.51

Thread C Time: 3482.54490 ms

Average of thread B is: 50.51

Thread B Time: 3509.74798 ms

3 Threads Time: 3510.03289 ms
Master Time: 4259.32813 ms
```
 
2.
```
Average of thread B is: 50.53

Thread B Time: 3313.21692 ms

Average of thread C is: 50.53

Thread C Time: 3348.64497 ms

Average of thread A is: 50.53

Thread A Time: 3389.78386 ms

3 Threads Time: 3390.14912 ms
Master Time: 4094.55204 ms 
```
## Files

### Karena Qian – Threads.c
Contains a multi-threaded program that creates a text file (called Data.txt) with 1,000,000 random numbers from 1-100, creates 3 (or any number (non-negative please), preferably up to 25) concurrently executing threads, each copying Data.txt to a new file (called Data_Thread_X.txt, where X is a capital letter identifying a particular thread) and calculating the average of the numbers in Data.txt, and times each thread, including the main thread, and all threads together. Output includes: averages calculated by the threads (should be identical), execution times of each thread, the execution time of the threads altogether, and the execution time of the main thread (called “master time”).
### my_threads.c
A .c header file that provides wrapper versions of the POSIX pthread API as well as a time getter wrapper function. (Provided by Professor Cameron)

## Command Line Execution Commands

### Compile and build executable “thread”:

`gcc 'Karena Qian - Threads.c' -pthread -o thread -g`

### Run “thread” executable:

`./thread`
 
## Analysis
In the output of test01, the total time of threads A, B, and C is 3510.03289 ms and the total time of the main thread is 4259.32813 ms. Similarly, in the output of test02, the total time of threads A, B, and C is 3390.14912 ms and the total time of the main thread is 4094.55204 ms. Because the main thread not only has to execute its own code, but also has to wait for all three threads to finish (because of the pthread join() function), it takes longer to finish than all of its three children threads. This is why the execution time of the main thread in both executions is greater than the execution time of all three child threads.
The output of test01 shows thread A, followed by thread C then thread B, and the output of test02 shows thread B, followed by thread C then thread A. Moreover, the output for test01 shows that the execution time for thread A (3468.38903 ms) is less than that of thread C (3482.54490 ms), which is less than that of thread B (3509.74798 ms); and the output for test02 shows that the execution time for thread B (3313.21692 ms) is less than that of thread C (3348.64497 ms) which is less than that of thread A (3389.78386 ms). However, the deviation between the times is very small, so they are barely noticeable when executing. Nevertheless, this shows that even though all 3 threads execute the same code, it may take longer or shorter to execute, which may depend on a number of factors, perhaps including how busy the thread’s core is and/or how often it gets interrupted, and context switched. (To be honest, I had other processes open while executing the threads program, so this may very much likely be the case.) Since, as mentioned in the comments, the threads program was executed on a 4-core device, each thread is probably executed on its own core, and thus, the execution time of each of the three threads of both executions are relatively close (in the most optimal (but probably unrealistic) case, the time it takes for every thread to execute would be exactly the same).

## Comments
My program has been programmed from the start to write a different set of randomly generated numbers from 1-100 to Data.txt. By including the flag O_TRUNC and the value 0644 (which is most likely some kind of permission value (CHMOD Calculator, n.d.)) in the system call `open()`, a particular file will be able to be entirely erased and overwritten with new data, if it exists (IBM, 2021a). Every time my program executes, it will erase the entire Data.txt file (if it exists), then fill it with 1,000,000 newly generated random numbers (thanks to some built-in code in the main thread). I also used this process for the thread function, since the contents of the files generated by the threads need to match Data.txt’s content. 
One more thing: the device that ran the program has 4 cores.
 
## Assignment Reflections

### A.	What was the most difficult thing for you in this assignment? You can list more than one if you would like.

This assignment was relatively easy. One of the only difficult things I encountered while working on this assignment was figuring out how use the .c header file to create and execute a single pthread, but even that was easily resolved in the end. (I was just confused on how to include a .c file and had forgotten to include the -pthread flag when compiling.) Overall, the most difficult thing for me was actually getting started on this assignment. When I first received it, it looked really intimidating, so I hesitated and didn’t start it right away. It wasn’t until almost a week after receiving the assignment that I got the courage and motivation to start, and since then, it has been smooth sailing.

### B.	What are 2 learning you took away from this assignment?

See below. 

## Learnings

- I learned how to use the system calls `open()`, `read()`, `write()`, and `close()` to open/create files, read from files, write to files, and close files respectively (GeeksforGeeks, 2023).
- Concerning `write()`, I learned how to use a buffer and `sprintf()` to write a single char or a digit to a file (Sales, 2019).
- Concerning `open()`, I learned the purpose of the different kinds of parameters, particularly O_TRUNC (IBM, 2021a) and 0644 (CHMOD Calculator, n.d.), in modifying the operations that can be done on a particular file.
- I also learned how to use the my_threads.c wrapper POSIX pthread API to create and run multiple threads concurrently (Andrew, 2012).
- I also learned how to use the sys/time.h library to calculate the wall time of the execution but ended up not having to use it since my_threads.c already provides a time function (Ferreira, 2022).
- Finally, I learned how to create a working multi-threaded program, where the main program creates multiple child threads that work concurrently.
 
## References
- Andrew. (2012, May 4). Include c file in another. [Online forum post]. StackOverflow. https://stackoverflow.com/questions/10448047/include-c-file-in-another 
- Cameron, A. M. (n.d.). Lecture12 – concurrency [PowerPoint slides]. Canvas. https://canvas.spu.edu/courses/59709/files/3916185?module_item_id=928825 
- CHMOD Calculator. (n.d.). Chmod 0644. https://chmodcommand.com/chmod-0644/ 
- CSstudent. (2019, May 13). How do you pass an int value through a void pointer parameter of a function and convert it back to an int value? [Online forum post]. StackOverflow. https://stackoverflow.com/questions/56105143/how-do-you-pass-an-int-value-through-a-void-pointer-paramater-of-a-function-and 
- fandyushin. (2016, February 15). Creating threads in a loop. [Online forum post]. StackOverflow. https://stackoverflow.com/questions/35403892/creating-threads-in-a-loop  
- Ferreira, C. (2022, April 14). 8 ways to measure execution time in C/C++. Medium. https://levelup.gitconnected.com/8-ways-to-measure-execution-time-in-c-c-48634458d0f9
- GeeksforGeeks. (2023, May 7). Input-output system calls in C: Create, open, close, read, write. https://www.geeksforgeeks.org/input-output-system-calls-c-create-open-close-read-write/  
- IBM. (2021a, April 14). Open()--open file. https://www.ibm.com/docs/en/i/7.3?topic=ssw_ibm_i_73/apis/open.html 
- IBM. (2021b, April 14). Pthread apis. https://www.ibm.com/docs/en/i/7.2?topic=category-pthread-apis
- IBM. (2021c, April 14). Writing and compiling threaded programs. https://www.ibm.com/docs/en/i/7.2?topic=ssw_ibm_i_72/apis/concept1.html   
- Sales, M. (2019, October 6). How to write integers with write() function in c? [duplicate]. [Online forum post]. StackOverflow. https://stackoverflow.com/questions/58259818/how-to-write-integers-with-write-function-in-c 
- UPENDRA BARTWAL,. (2022, August 24). Generating random number in a range in C. GeeksforGeeks. https://www.geeksforgeeks.org/generating-random-number-range-c/ 
